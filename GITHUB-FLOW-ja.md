# github flow
このリポジトリは [github flow](https://gist.github.com/Gab-km/3705015) に基づいて管理されています。

## ブランチ命名規則
github flow におけるプルリクエストのブランチの命名規則を以下に示します。

機能種別/派生元リビジョン/機能名

例えば、 Feature/2.2.12-3-g371b837/support-bonding-NIC のようなブランチ名を使用します。

### 機能種別
機能種別には以下のいずれかを指定します。

|機能種別|説明|
|----|----|
|Feature|新機能を実装する場合には機能種別に "Feature" を指定します。|
|Fix|バグ修正を行う場合には機能種別に "Fix" を指定します。|
|Docs|ドキュメント、サンプルを修正する場合には機能種別に "Docs" を指定します。|

### 機能名
機能名は短い英文です。空白の代わりにハイフン(-)を使用します。


## 開発手順
以下に修正を main ブランチにマージする手順を示します。

1. ブランチの作成
```shell
git checkout -b ブランチ名
```
2. 修正&テスト
1. ステージング
1. commit
1. push
> :information_source: **RC 版をリリースする場合** コミットログに `[[PRERELEASE]]` を含めて commit ~ push してください。Github Action workflow がこれを検出し、`0.1.1-rc${ブランチ名の sha256 ハッシュの先頭８文字}.0` の書式のバージョンを割り当て、リリースします。

6. プルリクエストの作成

> 手順5. を実行後、Web で 当該リポジトリを参照すると、"Your recent pushed branch" としてブランチが表示されているので、「Compare & pull request」ボタンをクリックしてください。

7.  レビューと修正

> レビューによりプルリクエストを修正する必要が生じた場合は、ローカルリポジトリを修正してpushしてください。すなわち、手順 2. から 5. を繰り返し実施してください。push すると自動的に pull request に組み込まれるので、 Web 上の当該リポジトリの Pull requests から自分のプルリクエストを開き、コメントを入力することで議論を続行してください。

> プルリクエストの名前は自動的にブランチ名から作成されますが、先頭に[]で囲んで機能種別を追加してください。

> 修正を複数人で行う場合はブランチをそれぞれのローカルリポジトリに pull するして修正してください。

8. マージ
> レビューが終わったプルリクエストは「Squash and merge」をクリックしてマージしてください。

> :information_source: **バージョン番号の更新** Github Action workflow がマージを検出し、自動的にバージョンをインクリメント～ commit ～ push します。バージョン更新内容について、コミットログに `[[MAJOR]]` が含まれる場合はメジャーバージョンを、`[[MINOR]]`が含まれる場合はマイナーバージョンを、それ以外の場合はパッチバージョンを更新します。更新内容が非互換を伴う場合（メジャーバージョンアップデート）や、機能追加を伴う場合（マイナーバージョンアップデート）には、マージメッセージで `[[MAJOR]]` や `[[MINOR]]` を指定してください。
> :information_source: **バージョン番号記載ファイルの衝突** 複数の修正が並行して稼働している場合、マージ時に package.json 等のバージョン番号記載ファイルの変更が衝突する可能性があります。この場合の衝突の編集で、バージョン番号が巻き戻らないよう、main ブランチの最新のバージョン番号を採用するようにしてください

9. ローカルリポジトリのブランチの削除
```shell
git branch -D ブランチ名
```
10. リポジトリのブランチの削除
> マージが終わったプルリクエストを Web で開き、「Delete branch」をクリックしてブランチを削除してください。

## Stable ブランチの運用ルール
本リポジトリでは、必要に応じて旧バージョンのソースコードを Stable ブランチで管理します。 Stable ブランチの運用ルールは以下のとおりです。
- ブランチ名は `Stable-${メジャーバージョン}.${マイナーバージョン}` の形式とします
- 当該ブランチに対する push またはマージが実行された場合、Github Action workflow によってパッチバージョンがインクリメントされます。
- main ブランチと共通の問題点を修正する場合、まず main ブランチに修正を反映し、その後 cherry-pick で Stable ブランチに反映するよう心掛けてください